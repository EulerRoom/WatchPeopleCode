{% extends "base.html" %}
{% import "macros.html" as macros with context %}

{% block title %} Streamer {{ streamer.reddit_username }} {% endblock %}

{% block styles %}
  {{super()}}
  <link rel="stylesheet" href="{{url_for('static', filename='chat.css')}}">
{% endblock %}

{% block content %}
  {{super()}}
  {# do not move the next string, it's here because it's needed before using jwplayer #}
  <script type="text/javascript" src="http://jwpsrv.com/library/6VhvUr6JEeSgMBJtO5t17w.js"></script>
  <div class="container">
    <div class="col-md-offset-2 col-md-8">
      <p class="text-center"><a href={{url_for(".index")}}>Back to main page</a></p>
    </div>

    <div class="col-md-8">
      <strong>Reddit username:</strong> <a href='http://www.reddit.com/user/{{ streamer.reddit_username }}'> {{ streamer.reddit_username }}</a>
      {% if streamer == current_user %}
        <div class="info-block" {% if edit %} style="display:none;" {% endif %}>
            <strong>Youtube channel:</strong>
            {% if streamer.youtube_channel %}
              <a href='http://www.youtube.com/channel/{{ streamer.youtube_channel }}'>
              {{ streamer.youtube_name if streamer.youtube_name else streamer.youtube_channel }}
              </a>
            {% endif %}
            <br>
            <strong>Twitch:</strong> 
            {% if streamer.twitch_channel %}
              <a href='http://www.twitch.tv/{{ streamer.twitch_channel }}'>
                {{ streamer.twitch_channel }}
              </a>
            {% endif %}
            <br>
            {% if streamer.info %}
              <strong>Info:</strong> {{ streamer.info | nl2br }}
            {% endif %}
              <br>
              <br>
              <div class="text-left"><button type="button" class="btn btn-default edit-button">Edit info</button></div>
        </div>

        <form action="" method="POST" class="form form-edit-info" role="form" {% if not edit %} style="display:none;" {% endif %}>
          <br>
          <div class="form-group">
            {{ form.hidden_tag() }}
            {{ wtf.form_field(form.youtube_channel) }}
            {{ wtf.form_field(form.twitch_channel) }}
            {{ wtf.form_field(form.info, rows=10) }}
            {{ wtf.form_field(form.submit_button, button_map={'submit_button': 'default'}) }}
          </div>
        </form>
      {% else %}
        {% if streamer.youtube_channel %}
          <br>
          <strong>Youtube channel:</strong>
          <a href='http://www.youtube.com/channel/{{ streamer.youtube_channel }}'>
            {{ streamer.youtube_name if streamer.youtube_name else streamer.youtube_channel }}
          </a>
        {% endif %}
        {% if streamer.twitch_channel %}
          <br>
          <strong>Twitch:</strong> 
          <a href='http://www.twitch.tv/{{ streamer.twitch_channel }}'>
            {{ streamer.twitch_channel }}
          </a>
        {% endif %}
        {% if info %}
          Info: {{ streamer.info | nl2br }}
        {% endif %}
      {% endif %}
      <hr><br>
    </div>

    {% if wpc_stream %}
      <div class="col-md-8">
        {{ wpc_stream.title + ' |' if wpc_stream.title else '' }}
        {{ wpc_stream.current_viewers }} viewers
        <br>
        {{ wpc_stream.html_code(autoplay=True)|safe }}
        <hr>
      </div>

      <div class="col-md-4">
        <br>
        <div class="panel panel-default panel-chat">

          <div class="panel-heading">
            <h3 class="panel-title">Chat</h3>
          </div>

          <div class="panel-body">
            <ul class="messages"></ul>
            <form class="compose-message-form">
              <div class="form-group">
                <textarea class="form-control" name="message"></textarea>
                <br>
                <button class="btn btn-info" type="submit">Send </button>
              </div>
            </form>
          </div>

        </div>
      </div>
    {% endif %}

    <div class="col-md-8">
      {{ macros.render_pagination(streams) }}
      <br>
    </div>

    {% for stream in streams.items %}
      {% if stream != wpc_stream %}
        <div class="col-md-8">
          <a href={{ stream.normal_url() }}> {{ stream.title if stream.title else stream.normal_url() }}</a>
          <br>
          {{ stream.html_code(autoplay=(loop.index == 1 and wpc_stream is none) if stream.status == 'live' else False )|safe }}
          <hr>
        </div>
      {% endif %}
    {% endfor %}

    <div class="col-md-8">
      {{ macros.render_pagination(streams) }}
    </div>

  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='scripts/socket.io.min.js') }}"></script>
  <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
  <script src="{{ url_for('static', filename='scripts/chat.js') }}"></script>

  <script>
    (function($, window, undefined){
      $(".edit-button").click(function() {
        $(".info-block").hide();
        $(".form-edit-info").show();
      });
    }($, window));
  </script> 
{% endblock %}
