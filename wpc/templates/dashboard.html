{% extends "base.html" %}
{% import "macros.html" as macros with context %}

{% block title %} WatchPeopleCode: dashboard {% endblock %}

{% block content %}
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h2> Welcome to your dashboard, {{current_user.reddit_username}}!</h2>
        {% if current_user.subscribers.count() %}
          <h3> You have {{current_user.subscribers.count()}} subscribers!</h3>
        {% endif %}
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="email-info">
          {{ wtf.quick_form(email_form) }}
        </div>
      </div>
    </div>
    <hr>
    <button type="button" class="btn btn-default btn-primary show-private-info-button">Show private info</button>
    <button type="button" class="btn btn-default btn-primary hide-private-info-button" style="display:none;">Hide private info</button>
    <div class="private-info" style="display:none;">
      <div class="row">
        <div class="col-md-8">
          <form>
            <div class="form-group">
              <label for="rtmp_url">WPC RTMP URL</label>
              <input type="text" class="form-control" id="dashboard_rtmp_url" readonly value="rtmp://{{config['RTMP_SERVER']}}/live" onclick="this.select();">
            </div>
            <div class="form-group">
              <label for="rtmp_key">WPC RTMP KEY</label>
              <input type="text" class="form-control" id="dashboard_rtmp_key" readonly value="{{current_user.streaming_key()}}" onclick="this.select();">
            </div>
          </form>
          <button class="btn btn-default btn-xs" id="regenerate-rtmp-key">Generate new key</button>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-md-12">
          {{wtf.quick_form(rtmp_redirect_form)}}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{super()}}
  <script>
    (function($, window, undefined){
      $(".show-private-info-button").click(function() {
        $(".show-private-info-button").hide();
        $(".hide-private-info-button").show();
        $(".private-info").show();
      });
      $(".hide-private-info-button").click(function() {
        $(".show-private-info-button").show();
        $(".hide-private-info-button").hide();
        $(".private-info").hide();
      });
      $("#regenerate-rtmp-key").click(function() {
        $.ajax("/_regenerate_rtmp_key").done(function(data){
            $('#dashboard_rtmp_key').val(data.rtmp_key);
        });
      });
    }($, window));
  </script>
{% endblock %}

